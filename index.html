<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharos LeaseBridge | Decentralized RWA Leasing Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #0f172a; 
            --secondary: #1e293b; 
            --accent: #3b82f6; 
            --gold: #d97706; 
            --success: #10b981; 
            --warning: #f59e0b; 
            --danger: #ef4444; 
            --text: #f1f5f9; 
            --border: rgba(255, 255, 255, 0.1); 
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom, var(--primary), #020617);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid var(--border); }
        .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 4px 20px rgba(59, 130, 246, 0.2); }
        .beacon-bg {
            background: radial-gradient(circle at 50% 30%, rgba(59, 130, 246, 0.3) 0%, transparent 70%),
                        url('https://images.unsplash.com/photo-1506748686214-e9df14d4d9d0?auto=format&fit=crop&w=1920&q=80') no-repeat center/cover;
            background-blend-mode: overlay;
        }
        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
    </style>
</head>
<body class="relative">

    <!-- Background Beacon Effect -->
    <div class="fixed inset-0 z-0 pointer-events-none opacity-20">
        <div class="absolute top-0 left-1/2 w-96 h-96 bg-blue-500 rounded-full filter blur-3xl animate-pulse-slow"></div>
    </div>

    <header class="relative z-10 max-w-7xl mx-auto flex justify-between items-center py-6 px-4 md:px-8">
        <div class="flex items-center gap-3">
            <!-- Logo SVG: Lighthouse Bridge Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="w-12 h-12">
                <path fill="#3b82f6" d="M24 4L4 20v24h40V20L24 4z"/>
                <path fill="#d97706" d="M24 4l20 16v24H4V20L24 4zM24 12l-12 8v16h24V20l-12-8z"/>
                <circle fill="#fff" cx="24" cy="28" r="4"/>
                <path fill="#3b82f6" d="M20 40h8v4h-8z"/>
            </svg>
            <h1 class="text-2xl font-bold tracking-tight">Pharos LeaseBridge</h1>
        </div>
        <button id="connectBtn" class="bg-accent hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-semibold transition-all shadow-md hover:shadow-lg md:px-8 md:py-3">
            Connect Wallet
        </button>
    </header>

    <main class="relative z-10 max-w-7xl mx-auto px-4 md:px-8 space-y-16">

        <!-- Hero Section -->
        <section class="beacon-bg glass rounded-3xl p-8 md:p-12 text-center shadow-2xl md:flex md:flex-col md:justify-center md:items-center">
            <h2 class="text-4xl md:text-5xl font-extrabold mb-4 leading-tight">Bridge Real World Assets to the Blockchain</h2>
            <p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl mx-auto">Pharos LeaseBridge empowers decentralized leasing of premium RWAs. Secure, transparent, and efficient – guided by the light of Pharos blockchain for a brighter DeFi future.</p>
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <a href="#gallery" class="bg-gold hover:bg-amber-600 text-white px-8 py-3 rounded-lg font-semibold transition-all">Explore Assets</a>
                <a href="#about" class="border border-accent text-accent px-8 py-3 rounded-lg font-semibold hover:bg-accent/10 transition-all">Learn More</a>
            </div>
        </section>

        <!-- Wallet Info -->
        <div id="walletInfo" class="hidden text-right text-sm text-accent font-medium">
            Connected: <span id="userAddress" class="font-mono">0x...</span> | <span id="isAdmin" class="text-gold"></span>
        </div>

        <!-- Admin Panel -->
        <section id="adminSection" class="hidden glass p-8 rounded-3xl shadow-xl">
            <h2 class="text-2xl font-bold mb-6">Admin Dashboard</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Mint Property -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-semibold mb-4">Mint New RWA</h3>
                    <input id="pName" type="text" placeholder="Property Name" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-3 outline-none focus:border-accent">
                    <input id="pImg" type="text" placeholder="Image URL" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-3 outline-none focus:border-accent">
                    <button onclick="mintProperty()" id="mintBtn" class="w-full bg-accent hover:bg-blue-500 text-white py-3 rounded-lg font-semibold transition-all">Deploy RWA</button>
                </div>
                <!-- Update Daily Rate -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-semibold mb-4">Update Daily Rate</h3>
                    <input id="newRate" type="number" placeholder="New Rate (in wei)" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-3 outline-none focus:border-accent">
                    <button onclick="updateDailyRate()" class="w-full bg-warning hover:bg-amber-600 text-white py-3 rounded-lg font-semibold transition-all">Update Rate</button>
                </div>
                <!-- Verify Property -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-semibold mb-4">Verify Property</h3>
                    <input id="verifyId" type="number" placeholder="Token ID" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-3 outline-none focus:border-accent">
                    <select id="verifyStatus" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-3 outline-none focus:border-accent">
                        <option value="true">Verify</option>
                        <option value="false">Unverify</option>
                    </select>
                    <button onclick="verifyProperty()" class="w-full bg-success hover:bg-green-600 text-white py-3 rounded-lg font-semibold transition-all">Apply</button>
                </div>
                <!-- Withdraw & Pause -->
                <div class="glass p-6 rounded-2xl">
                    <h3 class="font-semibold mb-4">Contract Controls</h3>
                    <button onclick="withdrawFunds()" class="w-full bg-gold hover:bg-amber-600 text-white py-3 rounded-lg font-semibold mb-3 transition-all">Withdraw Revenue</button>
                    <button onclick="togglePause()" id="pauseBtn" class="w-full bg-danger hover:bg-red-600 text-white py-3 rounded-lg font-semibold transition-all">Pause Contract</button>
                </div>
            </div>
        </section>

        <!-- RWA Gallery -->
        <section id="gallery">
            <h2 class="text-3xl font-bold mb-8">RWA Registry</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="assetGrid">
                <div class="col-span-full py-24 text-center glass rounded-3xl shadow-xl">
                    <div class="inline-block w-8 h-8 border-4 border-accent/30 border-t-accent rounded-full animate-spin mb-4"></div>
                    <p class="text-gray-400 text-base font-medium">Syncing with Pharos Ledger...</p>
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section id="about" class="glass p-8 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6">About Pharos LeaseBridge</h2>
            <p class="text-lg text-gray-300 mb-4">Pharos LeaseBridge is a pioneering platform on the Pharos blockchain, enabling seamless leasing of Real World Assets (RWAs) through NFTs. Our vision merges the reliability of a lighthouse (Pharos) with innovative bridging of traditional assets to DeFi.</p>
            <ul class="list-disc pl-6 space-y-2 text-gray-300">
                <li>Secure Rentals: Time-based leasing without ownership transfer.</li>
                <li>Admin Controls: Mint, verify, and manage assets effortlessly.</li>
                <li>Investor Appeal: Transparent revenue model with withdrawal options.</li>
                <li>Unique Features: Extension of rentals, verification badges, and pause functionality for security.</li>
            </ul>
        </section>

    </main>

    <footer class="relative z-10 max-w-7xl mx-auto px-4 md:px-8 py-8 text-center text-gray-500 text-sm">
        &copy; 2026 Pharos LeaseBridge. All rights reserved. Powered by Pharos Atlantic.
    </footer>

    <script>
        // CONFIG
        const PHAROS_HEX_ID = "0xa8229"; 
        const CONTRACT_ADDR = "0xC4F832c8bC9393B1430e53Cd4C43eB2D5D3291BF";
        const RPC_URL = "https://atlantic.dplabs-internal.com";

        const ABI = [
            "function owner() view returns (address)",
            "function mintProperty(string _name, string _image) external",
            "function verifyProperty(uint256 tokenId, bool _isVerified) external",
            "function rentProperty(uint256 tokenId, uint64 daysToRent) external payable",
            "function extendRental(uint256 tokenId, uint64 additionalDays) external payable",
            "function updateDailyRate(uint256 newRate) external",
            "function withdraw() external",
            "function pause() external",
            "function unpause() external",
            "function propertyInfo(uint256) view returns (string name, string imageUri, bool isVerified)",
            "function propertyRentals(uint256) view returns (address renter, uint64 expiry)",
            "function dailyRate() view returns (uint256)",
            "function nextTokenId() view returns (uint256)",
            "function isRented(uint256) view returns (bool)",
            "function getRentalInfo(uint256) view returns (address renter, uint64 expiry)",
            "function paused() view returns (bool)"
        ];

        let provider, signer, contract, userAddr;

        // Load on start
        window.addEventListener('DOMContentLoaded', async () => {
            const readOnlyProvider = new ethers.JsonRpcProvider(RPC_URL);
            const readOnlyContract = new ethers.Contract(CONTRACT_ADDR, ABI, readOnlyProvider);
            await refreshGallery(readOnlyContract);
        });

        // Connect Wallet
        async function connect() {
            if (!window.ethereum) return alert("Install MetaMask or similar wallet.");
            
            try {
                provider = new ethers.BrowserProvider(window.ethereum);
                const accounts = await provider.send("eth_requestAccounts", []);
                signer = await provider.getSigner();
                userAddr = accounts[0];

                const network = await provider.getNetwork();
                if (network.chainId !== BigInt(688689)) {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: PHAROS_HEX_ID }],
                    });
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                }

                contract = new ethers.Contract(CONTRACT_ADDR, ABI, signer);
                
                document.getElementById('userAddress').innerText = userAddr.slice(0,6) + '...' + userAddr.slice(-4);
                document.getElementById('walletInfo').classList.remove('hidden');
                document.getElementById('connectBtn').innerText = "Connected";
                document.getElementById('connectBtn').classList.replace('bg-accent', 'bg-success');

                const owner = await contract.owner();
                const isOwner = userAddr.toLowerCase() === owner.toLowerCase();
                if (isOwner) {
                    document.getElementById('adminSection').classList.remove('hidden');
                    document.getElementById('isAdmin').innerText = "Admin";
                    updatePauseButton(await contract.paused());
                }

                refreshGallery(contract);
            } catch (e) {
                alert("Connection failed: " + e.message);
            }
        }

        // Refresh Gallery
        async function refreshGallery(targetContract) {
            const grid = document.getElementById('assetGrid');
            grid.innerHTML = "";
            try {
                const count = Number(await targetContract.nextTokenId());
                const rate = ethers.formatEther(await targetContract.dailyRate());
                const now = Math.floor(Date.now() / 1000);

                if (count <= 1) {
                    grid.innerHTML = `<p class="col-span-full text-center text-gray-400 py-12 text-lg font-medium glass rounded-3xl">No RWAs minted yet. Deploy via Admin Dashboard.</p>`;
                    return;
                }

                for (let i = 1; i < count; i++) {
                    const info = await targetContract.propertyInfo(i);
                    const rental = await targetContract.getRentalInfo(i);
                    const isRented = await targetContract.isRented(i);
                    const isCurrentRenter = rental.renter.toLowerCase() === userAddr?.toLowerCase();

                    grid.innerHTML += `
                        <div class="glass rounded-3xl overflow-hidden flex flex-col p-6 shadow-xl hover-lift">
                            <img src="${info.imageUri}" class="w-full h-56 object-cover rounded-2xl mb-4" onerror="this.src='https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=800'">
                            <h3 class="font-bold text-xl mb-2">${info.name} ${info.isVerified ? '<span class="text-success text-sm">✓ Verified</span>' : ''}</h3>
                            <p class="text-sm text-gray-400 mb-4">Daily Rate: ${rate} PHRS</p>
                            ${isRented ? `
                                <div class="bg-secondary p-4 rounded-2xl mb-4">
                                    <p class="text-sm">Rented until: ${new Date(rental.expiry * 1000).toLocaleString()}</p>
                                    ${isCurrentRenter ? `
                                        <input id="extendDays-${i}" type="number" min="1" placeholder="Extend Days" class="w-full bg-transparent border border-gray-600 p-2 rounded-lg text-sm mt-2 mb-2 outline-none focus:border-accent">
                                        <div id="extendInv-${i}" class="text-sm text-gray-400 mb-2">Total: 0.00 PHRS</div>
                                        <button onclick="extendRental(${i})" class="w-full bg-warning hover:bg-amber-600 text-white py-2 rounded-lg font-semibold">Extend Lease</button>
                                    ` : '<p class="text-warning text-sm">Currently Leased</p>'}
                                </div>
                            ` : `
                                <input id="days-${i}" type="number" min="1" placeholder="Lease Days" class="w-full bg-transparent border border-gray-600 p-3 rounded-lg text-sm mb-2 outline-none focus:border-accent">
                                <div id="inv-${i}" class="text-sm text-gray-400 mb-2">Total: 0.00 PHRS</div>
                                <button onclick="rentAsset(${i})" class="w-full bg-accent hover:bg-blue-500 text-white py-3 rounded-lg font-semibold transition-all">Lease Now</button>
                            `}
                        </div>`;
                }
            } catch (err) {
                grid.innerHTML = `<p class="col-span-full text-center text-danger py-12 text-lg font-medium glass rounded-3xl">Error loading assets: ${err.message}</p>`;
            }
        }

        // Helpers
        function calcInvoice(id, rate, isExtend = false) {
            const prefix = isExtend ? 'extend' : '';
            const val = document.getElementById(`\( {prefix}Days- \){id}`).value || 0;
            document.getElementById(`\( {prefix}Inv- \){id}`).innerText = `Total: ${(val * rate).toFixed(2)} PHRS`;
        }

        async function rentAsset(id) {
            if (!contract) return connect();
            const days = document.getElementById(`days-${id}`).value;
            if (!days || days <= 0) return alert("Enter valid days.");
            try {
                const rate = await contract.dailyRate();
                const total = rate * BigInt(days);
                const tx = await contract.rentProperty(id, days, { value: total });
                await tx.wait();
                refreshGallery(contract);
            } catch (e) { alert("Rent failed: " + e.message); }
        }

        async function extendRental(id) {
            if (!contract) return connect();
            const days = document.getElementById(`extendDays-${id}`).value;
            if (!days || days <= 0) return alert("Enter valid days.");
            try {
                const rate = await contract.dailyRate();
                const total = rate * BigInt(days);
                const tx = await contract.extendRental(id, days, { value: total });
                await tx.wait();
                refreshGallery(contract);
            } catch (e) { alert("Extend failed: " + e.message); }
        }

        async function mintProperty() {
            const name = document.getElementById('pName').value;
            const img = document.getElementById('pImg').value;
            if (!name || !img) return alert("Fill fields.");
            const btn = document.getElementById('mintBtn');
            try {
                btn.innerText = "Deploying...";
                const tx = await contract.mintProperty(name, img);
                await tx.wait();
                document.getElementById('pName').value = "";
                document.getElementById('pImg').value = "";
                refreshGallery(contract);
            } catch (e) { alert("Mint failed: " + e.message); }
            btn.innerText = "Deploy RWA";
        }

        async function verifyProperty() {
            const id = document.getElementById('verifyId').value;
            const status = document.getElementById('verifyStatus').value === 'true';
            if (!id) return alert("Enter Token ID.");
            try {
                const tx = await contract.verifyProperty(id, status);
                await tx.wait();
                refreshGallery(contract);
            } catch (e) { alert("Verify failed: " + e.message); }
        }

        async function updateDailyRate() {
            const newRate = document.getElementById('newRate').value;
            if (!newRate || newRate <= 0) return alert("Enter valid rate.");
            try {
                const tx = await contract.updateDailyRate(BigInt(newRate));
                await tx.wait();
                refreshGallery(contract);
            } catch (e) { alert("Update failed: " + e.message); }
        }

        async function withdrawFunds() {
            try {
                const tx = await contract.withdraw();
                await tx.wait();
                alert("Withdrawn!");
            } catch (e) { alert("Withdraw failed: " + e.message); }
        }

        async function togglePause() {
            try {
                const paused = await contract.paused();
                const tx = paused ? await contract.unpause() : await contract.pause();
                await tx.wait();
                updatePauseButton(!paused);
            } catch (e) { alert("Pause toggle failed: " + e.message); }
        }

        function updatePauseButton(isPaused) {
            const btn = document.getElementById('pauseBtn');
            btn.innerText = isPaused ? "Unpause Contract" : "Pause Contract";
            btn.classList.toggle('bg-success', isPaused);
            btn.classList.toggle('bg-danger', !isPaused);
        }

        // Events
        document.getElementById('connectBtn').addEventListener('click', connect);
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', connect);
            window.ethereum.on('chainChanged', () => location.reload());
        }
    </script>
</body>
</html>
