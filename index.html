<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pharos LeaseBridge | Ø§Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --dark: #0a0c10; --white: #ffffff; }
        body { margin: 0; font-family: 'Tajawal', sans-serif; background-color: var(--dark); color: var(--white); scroll-behavior: smooth; }
        
        /* Ø®Ù„ÙÙŠØ© Ø¬Ø°Ø§Ø¨Ø© Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ† */
        .hero { 
            background: linear-gradient(rgba(10, 12, 16, 0.8), rgba(10, 12, 16, 0.8)), 
                        url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=1920&q=80');
            background-size: cover; background-position: center; min-height: 80vh;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px;
        }

        .hero h1 { font-size: 3rem; margin: 0; color: var(--gold); text-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .hero p { font-size: 1.2rem; max-width: 700px; line-height: 1.6; opacity: 0.9; }

        .container { max-width: 1100px; margin: -50px auto 50px; padding: 0 20px; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; padding: 30px; margin-bottom: 30px; }

        .btn-gold { background: var(--gold); color: var(--dark); border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 1.1rem; cursor: pointer; transition: 0.3s; }
        .btn-gold:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(197, 160, 89, 0.4); }

        /* Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª */
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 30px; }
        .step { text-align: center; padding: 20px; border-radius: 20px; background: rgba(197, 160, 89, 0.05); }
        .step i { font-size: 2rem; color: var(--gold); display: block; margin-bottom: 10px; }

        /* Ø§Ù„Ù…Ø¹Ø±Ø¶ */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; margin-top: 40px; }
        .property-card { background: #161a1f; border-radius: 25px; overflow: hidden; border: 1px solid rgba(255,255,255,0.05); }
        .property-img { width: 100%; height: 200px; object-fit: cover; }
        .card-content { padding: 20px; }
        
        .badge { display: inline-block; padding: 5px 15px; border-radius: 10px; font-size: 0.8rem; margin-bottom: 10px; }
        .available { background: #27ae60; }
        .occupied { background: #c0392b; }

        input { width: 100%; padding: 12px; margin: 10px 0; border-radius: 12px; border: 1px solid #333; background: #000; color: #fff; text-align: center; }
        #adminPanel { display: none; border: 2px dashed var(--gold); }
    </style>
</head>
<body>

    <section class="hero">
        <h1>LEASEBRIDGE | Ù„ÙŠØ² Ø¨Ø±ÙŠØ¯Ø¬</h1>
        <p>Ù†Ù‚Ù„Ø© Ù†ÙˆØ¹ÙŠØ© ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© (RWA). Ø§Ø³ØªØ«Ù…Ø±ØŒ Ø§Ø³ØªØ£Ø¬Ø±ØŒ ÙˆØªÙ…Ù„Ùƒ Ø­ØµØµØ§Ù‹ ÙÙŠ Ø£ÙØ®Ù… Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© Ø¹Ø¨Ø± Ø´Ø¨ÙƒØ© Pharos Atlantic ÙØ§Ø¦Ù‚Ø© Ø§Ù„Ø³Ø±Ø¹Ø©.</p>
        <button class="btn-gold" id="connectBtn" onclick="connect()">Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©</button>
        <p id="walletStatus" style="font-size: 0.9rem; margin-top: 15px; color: var(--gold);"></p>
    </section>

    <div class="container">
        <div class="glass-card">
            <h2 style="color: var(--gold);">Ù„Ù…Ø§Ø°Ø§ ØªØ®ØªØ§Ø± LeaseBridgeØŸ</h2>
            <p>Ù…Ø´Ø±ÙˆØ¹Ù†Ø§ ÙŠØ±Ø¨Ø· Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¨Ø§Ù„Ø¨Ù„ÙˆÙƒØ´ÙŠÙ†ØŒ Ù…Ù…Ø§ ÙŠÙˆÙØ± Ø³ÙŠÙˆÙ„Ø© ÙÙˆØ±ÙŠØ© ÙˆØ¹Ù‚ÙˆØ¯ Ø¥ÙŠØ¬Ø§Ø± Ø°ÙƒÙŠØ© ØªÙ†ÙØ° ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¯ÙˆÙ† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„ÙˆØ³Ø·Ø§Ø¡. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù‚ÙˆØ¯ Ù…Ø¤Ù…Ù†Ø© ÙˆÙ…Ø³Ø¬Ù„Ø© Ø¹Ù„Ù‰ Ø´Ø¨ÙƒØ© Pharos.</p>
            
            <div class="steps-grid">
                <div class="step"><div>1ï¸âƒ£</div><strong>Ø§Ø±Ø¨Ø· Ù…Ø­ÙØ¸ØªÙƒ</strong><p>Ø§Ø³ØªØ®Ø¯Ù… MetaMask Ø£Ùˆ OKX Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ØµØ©.</p></div>
                <div class="step"><div>2ï¸âƒ£</div><strong>Ø§Ø®ØªØ± Ø§Ù„Ø¹Ù‚Ø§Ø±</strong><p>ØªØµÙØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ«Ù‚Ø© ÙˆØ§Ù„Ù…ØªÙˆÙØ±Ø©.</p></div>
                <div class="step"><div>3ï¸âƒ£</div><strong>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</strong><p>Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø© ÙˆÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ø¶ØºØ·Ø© Ø²Ø± ÙˆØ§Ø­Ø¯Ø©.</p></div>
            </div>
        </div>

        <div id="adminPanel" class="glass-card">
            <h3 style="color: var(--gold);">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„ Ø¬Ø¯ÙŠØ¯</h3>
            <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø± (Ù…Ø«Ø§Ù„: ÙÙŠÙ„Ø§ Ø§Ù„Ù„Ø¤Ù„Ø¤Ø©)">
            <input type="text" id="pImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù‚Ø§Ø±">
            <button class="btn-gold" style="width: 100%;" onclick="mintRWA()">Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚</button>
        </div>

        <h2 id="marketplace">ğŸ™ï¸ Ø³ÙˆÙ‚ Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…ØªÙˆÙØ±Ø©</h2>
        <div id="gallery" class="gallery-grid">
            <p style="text-align: center; grid-column: 1/-1;">ÙŠØ±Ø¬Ù‰ Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Øµ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©...</p>
        </div>
    </div>

    <script>
        const CONTRACT_ADDR = "0x8067fe980e975ba291752a57586dbeb09641e1c3";
        const ABI = [
            "function mintProperty(string memory _name, string memory _image) external",
            "function rentProperty(uint256 _tokenId, uint64 _days) external payable",
            "function propertyInfo(uint256) public view returns (string name, string imageUri, bool isVerified)",
            "function propertyRentals(uint256) public view returns (address renter, uint64 expiry)",
            "function owner() public view returns (address)",
            "function dailyRate() public view returns (uint256)",
            "function nextTokenId() public view returns (uint256)"
        ];

        let signer, contract;

        async function connect() {
            if (!window.ethereum) return alert("Ø§Ù„Ù…Ø­ÙØ¸Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!");
            try {
                const provider = new ethers.providers.Web3Provider(window.ethereum);
                await provider.send("eth_requestAccounts", []);
                signer = provider.getSigner();
                const address = await signer.getAddress();
                contract = new ethers.Contract(CONTRACT_ADDR, ABI, signer);

                document.getElementById('walletStatus').innerText = "ØªÙ… Ø§Ù„Ø±Ø¨Ø·: " + address.substring(0,10) + "...";
                document.getElementById('connectBtn').style.display = "none";

                const owner = await contract.owner();
                if (address.toLowerCase() === owner.toLowerCase()) {
                    document.getElementById('adminPanel').style.display = "block";
                }
                loadGallery();
            } catch (err) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±Ø¨Ø·: " + err.message); }
        }

        async function loadGallery() {
            const gallery = document.getElementById('gallery');
            try {
                const total = await contract.nextTokenId();
                gallery.innerHTML = "";
                for (let i = 0; i < total; i++) {
                    const info = await contract.propertyInfo(i);
                    const rental = await contract.propertyRentals(i);
                    const isOccupied = rental.expiry > Math.floor(Date.now() / 1000);

                    gallery.innerHTML += `
                        <div class="property-card">
                            <img src="${info.imageUri}" class="property-img" onerror="this.src='https://via.placeholder.com/400x200?text=RWA+Asset'">
                            <div class="card-content">
                                <span class="badge ${isOccupied ? 'occupied' : 'available'}">${isOccupied ? 'Ù…Ø¤Ø¬Ø± Ø­Ø§Ù„ÙŠØ§Ù‹' : 'Ù…ØªØ§Ø­ Ù„Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±'}</span>
                                <h3>${info.name}</h3>
                                <p style="color: #aaa;">Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ: #${i}</p>
                                ${!isOccupied ? `
                                    <input type="number" id="days-${i}" placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…">
                                    <button class="btn-gold" style="width: 100%;" onclick="rent(${i})">Ø§Ø³ØªØ£Ø¬Ø± Ø§Ù„Ø¢Ù†</button>
                                ` : `<p style="color: var(--gold);">ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„Ø¹Ù‚Ø¯ ÙÙŠ: ${new Date(rental.expiry * 1000).toLocaleDateString('ar-SA')}</p>`}
                            </div>
                        </div>
                    `;
                }
            } catch (e) { console.error(e); }
        }

        async function rent(id) {
            const days = document.getElementById(`days-${id}`).value;
            try {
                const rate = await contract.dailyRate();
                // ØªØµØ­ÙŠØ­ Ø§Ù„Ø®Ø·Ø£ Ù‡Ù†Ø§: Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¶Ø±Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ ÙˆØ­Ø¯Ø§Øª BigNumber
                const totalCost = rate.mul(days); 
                const tx = await contract.rentProperty(id, days, { value: totalCost });
                await tx.wait();
                alert("ØªÙ…Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!");
                loadGallery();
            } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: " + e.message); }
        }

        async function mintRWA() {
            const name = document.getElementById('pName').value;
            const img = document.getElementById('pImg').value;
            try {
                const tx = await contract.mintProperty(name, img);
                await tx.wait();
                alert("ØªÙ… Ø¥Ø¯Ø±Ø§Ø¬ Ø§Ù„Ø£ØµÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
                loadGallery();
            } catch (e) { alert(e.message); }
        }
    </script>
</body>
</html>
